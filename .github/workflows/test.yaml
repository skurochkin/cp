name: Pull Request Approval Workflow

on:
  pull_request_review:
    types: [submitted]

jobs:
  check_approval:
    runs-on: ubuntu-latest
    steps:
      - name: Check if it's the first approval
        id: check_approval
        run: |
          pull_request_number=${{ github.event.pull_request.number }}
          commit_sha=${{ github.event.pull_request.head.sha }}

          # Fetch the list of approved reviews for the current pull request
          approved_reviews=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
                              -H "Accept: application/vnd.github.v3+json" \
                              ${{ github.api_url }}/repos/${{ github.repository }}/pulls/$pull_request_number/reviews \
                              | jq -r '.[] | select(.state == "APPROVED") | .commit_id')

          # Check if the current commit is in the list of approved commits
          if echo "$approved_reviews" | grep -q "$commit_sha"; then
            echo "::set-output name=first_approval::false"
          else
            echo "::set-output name=first_approval::true"
          fi

      - name: Execute workflow if it's the first approval
        if: steps.check_approval.outputs.first_approval == 'true'
        run: |
          # Your workflow steps go here
          echo "Test Request Best"
